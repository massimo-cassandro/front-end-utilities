{"version":3,"sources":["../_m-ckeditor-form-check.js","m-ckeditor-form-check.js"],"names":["options","default_options","requiredErrorMes","requiredElement","alertUI","mes","alert","window","mUtilities","ckeditor","cke_opts","Object","assign","editor_textareas","document","querySelectorAll","editors_required","forEach","item","required","parentNode","querySelector","classList","add","_form","onsubmit","e","editor","ckeditor_instances","id","cke_data","getData","replace","setData","trim","updateSourceElement","value","preventDefault","m_cke_form_check"],"mappings":"0BAOe,SAAUA,GAEvB,MAAMC,EAAkB,CACtBC,iBAAkBC,GACT,cAAcA,mBAEvBC,QAASC,IACPC,MAAMD,UAKsB,IAAtBE,OAAOC,aACfD,OAAOC,WAAa,SAEmB,IAA/BD,OAAOC,WAAWC,WAC1BF,OAAOC,WAAWC,SAAW,SAE2B,IAAhDF,OAAOC,WAAWC,SAASP,mBACnCK,OAAOC,WAAWC,SAASP,iBAAmBC,GACrC,cAAcA,yBAGwB,IAAvCI,OAAOC,WAAWC,SAASL,UACnCG,OAAOC,WAAWC,SAASL,QAAUC,IACnCC,MAAMD,KAKV,IAAIK,EAAWC,OAAOC,OAAO,GAAIX,EAAiBD,GAAW,GAAIO,OAAOC,WAAWC,UAAY,IAE7FI,EAAmBC,SAASC,iBAAiB,mBAC7CC,EAAmBF,SAASC,iBAAiB,6BAe/CC,EAAiBC,QAAQC,IACvBA,EAAKC,UAAW,EAChBD,EAAKE,WAAWC,cAAc,SAASC,UAAUC,IAAI,cAGvDT,SAASC,iBAAiB,QAAQE,QAAQO,IAExCA,EAAMC,SAAYC,IAEhBb,EAAiBI,QAAQC,IACvB,IAAIS,EAASC,mBAAmBV,EAAKW,IACnCC,EAAWH,EAAOI,UACpBD,EAAWA,EACRE,QAAQ,wBAAyB,IACjCA,QAAQ,wBAAyB,IACjCA,QAAQ,uBAAwB,IAGnCL,EAAOM,QAASH,EAASI,QACzBP,EAAOQ,wBAKTnB,EAAiBC,QAAQC,IACvB,IAAIA,EAAKkB,MAGP,OAFA1B,EAASN,QAAQM,EAASR,iBAAiBgB,EAAKW,KAChDH,EAAEW,kBACK,OClFjBC","sourcesContent":["/* global ckeditor_instances */\n\n/*\n  Controlli campi ckeditor\n*/\n\n\nexport default function (options) {\n\n  const default_options = {\n    requiredErrorMes: requiredElement => {\n      return `L'elemento ${requiredElement} è obbligatorio`;\n    },\n    alertUI: mes => {\n      alert(mes);\n    }\n  };\n\n  // per compatibilità con le versioni precedenti, deprecato\n  if(typeof window.mUtilities === 'undefined') {\n    window.mUtilities = {};\n  }\n  if(typeof window.mUtilities.ckeditor === 'undefined') {\n    window.mUtilities.ckeditor = {};\n  }\n  if(typeof window.mUtilities.ckeditor.requiredErrorMes === 'undefined') {\n    window.mUtilities.ckeditor.requiredErrorMes = requiredElement => {\n      return `L'elemento ${requiredElement} è obbligatorio`;\n    };\n  }\n  if(typeof window.mUtilities.ckeditor.alertUI === 'undefined') {\n    window.mUtilities.ckeditor.alertUI = mes => {\n      alert(mes);\n    };\n  }\n  // ------------------\n\n  let cke_opts = Object.assign({}, default_options, options || {}, window.mUtilities.ckeditor || {}),\n\n    editor_textareas = document.querySelectorAll('textarea.editor'),\n    editors_required = document.querySelectorAll('textarea.editor[required]');\n\n\n  // CAMPI REQUIRED\n  //=========================\n  /*\n    metodo per il controllo dei textarea required.\n    Il controllo va eseguito in due step:\n    - censimento dei campi required ed eliminazione dell'attributo\n      relativo per evitare errori al submit del form\n    - Al momento del submit, i campi required sono controllati\n      perché non siano vuoti (necessario farlo dopo il trim)\n\n    È necessario che ogni textarea abbia un id\n  */\n  editors_required.forEach(item => {\n    item.required = false;\n    item.parentNode.querySelector('label').classList.add('required');\n  });\n\n  document.querySelectorAll('form').forEach(_form => {\n\n    _form.onsubmit = (e) => {\n      // trimming\n      editor_textareas.forEach(item => {\n        let editor = ckeditor_instances[item.id],\n          cke_data = editor.getData();\n        cke_data = cke_data\n          .replace(/^((<p>&nbsp;<\\/p>)*)/i, '') // righe vuote all'inizio\n          .replace(/((<p>&nbsp;<\\/p>)*)$/i, '') // righe vuote alla fine\n          .replace(/( *(&nbsp;)*<\\/p>)$/i, ''); // spazi vuoti alla fine dei tag p\n\n        // https://ckeditor.com/docs/ckeditor5/latest/api/module_editor-classic_classiceditor-ClassicEditor.html#function-setData\n        editor.setData( cke_data.trim() );\n        editor.updateSourceElement();\n\n      });\n\n      // required\n      editors_required.forEach(item => {\n        if(!item.value) {\n          cke_opts.alertUI(cke_opts.requiredErrorMes(item.id));\n          e.preventDefault();\n          return false;\n        }\n      });\n    };\n\n  });\n\n}\n","import m_cke_form_check from '../_m-ckeditor-form-check';\nm_cke_form_check();\n"]}