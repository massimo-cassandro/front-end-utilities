{"version":3,"sources":["../_m-ckeditor-loader.js","m-ckeditor-loader.js"],"names":["loader_options","editor_list","document","querySelectorAll","window","mUtilities","cke_opts","Object","assign","cke_url","upl_url","img_viewer","ckeditor","length","ckeditor_instances","std_toolbar","lite_toolbar","xlite_toolbar","img_plugins","table_plugins","headings_plugins","script","createElement","onload","forEach","item","idx","options","uploaderUrl","uploadMaxSize","imgViewer","toolbar","dataset","ckeUplMaxSize","classList","contains","removePlugins","concat","filter","slice","ClassicEditor","create","then","editor","disabled","isReadOnly","id","el","closest","remove","catch","error","console","group","log","groupEnd","src","type","head","appendChild","m_cke_loader"],"mappings":"0BAMe,SAAUA,GAEvB,MAOMC,EAAcC,SAASC,iBAAiB,wBAEd,IAAtBC,OAAOC,aAA8BD,OAAOC,WAAa,IAEnE,IAAIC,EAAWC,OAAOC,OAAO,GAXL,CACtBC,QAAS,0CACTC,QAAS,0BACTC,WAAY,YAQoCX,GAAkB,GAAII,OAAOC,WAAWO,UAAY,IAEtG,GAAIX,EAAYY,OAAQ,CAMtBT,OAAOU,mBAAqB,GAE5B,MAAMC,EAAc,CAChB,UACA,IACA,OACA,SACA,OACA,IACA,iBAAkB,mBAAoB,kBAAmB,oBACzD,IACA,UAAW,SACX,IACA,eACA,eACA,IACA,cACA,aACA,cACA,OACA,QAGFC,EAAe,CACb,UACA,IACA,OACA,SACA,OACA,IACA,iBAAkB,mBAAoB,kBAAmB,oBACzD,IACA,UAAW,SACX,IACA,eACA,eACA,IAEA,aACA,cACA,OACA,QAGFC,EAAgB,CACd,UACA,IACA,OACA,SACA,OACA,IACA,iBAAkB,mBAAoB,kBAAmB,oBACzD,IACA,UAAW,SACX,IACA,eACA,eACA,IAEA,aAEA,OACA,QAGFC,EAAc,CAAC,iBAAkB,cAAe,QAAS,eAAgB,aAAc,cAAe,gBACtGC,EAAgB,CAAC,cAAe,QAAS,eAAgB,kBAAmB,uBAC5EC,EAAmB,CAAC,WAEtB,IAAIC,EAASnB,SAASoB,cAAc,UACpCD,EAAOE,OAAU,KAEftB,EAAYuB,SAAQ,SAAUC,EAAMC,GAElC,IAAIC,EAAU,CACZC,YAAatB,EAASI,QACtBmB,cAAgB,QAChBC,UAAWxB,EAASK,WACpBoB,QAAShB,GAIRU,EAAKO,QAAQC,gBACdN,EAAQE,cAAgBJ,EAAKO,QAAQC,eAInCR,EAAKS,UAAUC,SAAS,eAC1BR,EAAU,CACRI,QAASf,EACToB,cAAelB,GAETO,EAAKS,UAAUC,SAAS,kBAChCR,EAAU,CACRI,QAASd,EACTmB,cAAelB,EAAYmB,OAAOlB,KAInCM,EAAKS,UAAUC,SAAS,wBACzBR,EAAQI,QAAUJ,EAAQI,QAAQO,OAAOb,GAAiB,YAATA,GACjDE,EAAQS,cAAgBT,EAAQS,cAAcC,OAAOjB,IAI7B,MAAvBO,EAAQI,QAAQ,KACjBJ,EAAQI,QAAUJ,EAAQI,QAAQQ,MAAM,IAET,MAA9BZ,EAAQI,QAAQQ,OAAO,KACxBZ,EAAQI,QAAUJ,EAAQI,QAAQQ,MAAM,GAAI,IAK9CC,cAAcC,OAAOhB,EAAME,GAexBe,KAAMC,IACFlB,EAAKmB,WACND,EAAOE,YAAa,GAEtBzC,OAAOU,mBAAmBW,EAAKqB,GAAKrB,EAAKqB,GAAKpB,GAAOiB,EAGrDzC,SAASC,iBAAiB,mCAAmCqB,QAASuB,IACpEA,EAAGH,UAAW,EACdG,EAAGC,QAAQ,eAAed,UAAUe,OAAO,gBAG9CC,MAAOC,IAENC,QAAQC,MAAM,YAAc3B,GAC5B0B,QAAQD,MAAMA,GACdC,QAAQE,IAAI,WAAa7B,GACzB2B,QAAQG,iBAQhBlC,EAAOmC,IAAMlD,EAASG,QACtBY,EAAOoC,KAAO,kBACdvD,SAASwD,KAAKC,YAAYtC,ICtL9BuC","sourcesContent":["/* globals ClassicEditor */\n\n/*\n  FILE DA INCLUDERE per l'utilizzo di ckeditor\n*/\n\nexport default function (loader_options) {\n\n  const default_options = {\n    cke_url: '/assets/ckeditor-dist/m-ckeditor-min.js',\n    upl_url: '/ckeditor/file-uploader',\n    img_viewer: '/viewer/'  // (visualizzaione dei file da db, NB: con slash finale)\n  };\n\n\n  const editor_list = document.querySelectorAll('textarea.editor');\n\n  if(typeof window.mUtilities === 'undefined') { window.mUtilities = {};} // per compatibilità con le versioni precedenti, deprecato\n\n  let cke_opts = Object.assign({}, default_options, loader_options || {}, window.mUtilities.ckeditor || {});\n\n  if (editor_list.length) {\n\n    // Istanza ckeditor.\n    // L'istanza è raggiungibile tramite il suo id (se esiste)\n    // o, in sua mancanza, tramite l'indice dell'elemento\n    // es: ckeditor_instances.__textarea_id__\n    window.ckeditor_instances = {};\n\n    const std_toolbar = [\n        'heading',\n        '|',\n        'bold',\n        'italic',\n        'link',\n        '|',\n        'alignment:left', 'alignment:center', 'alignment:right', 'alignment:justify',\n        '|',\n        'outdent', 'indent',\n        '|',\n        'bulletedList',\n        'numberedList',\n        '|',\n        'imageUpload',\n        'blockQuote',\n        'insertTable',\n        'undo',\n        'redo'\n      ],\n\n      lite_toolbar = [\n        'heading',\n        '|',\n        'bold',\n        'italic',\n        'link',\n        '|',\n        'alignment:left', 'alignment:center', 'alignment:right', 'alignment:justify',\n        '|',\n        'outdent', 'indent',\n        '|',\n        'bulletedList',\n        'numberedList',\n        '|',\n        //'imageUpload',\n        'blockQuote',\n        'insertTable',\n        'undo',\n        'redo'\n      ],\n\n      xlite_toolbar = [\n        'heading',\n        '|',\n        'bold',\n        'italic',\n        'link',\n        '|',\n        'alignment:left', 'alignment:center', 'alignment:right', 'alignment:justify',\n        '|',\n        'outdent', 'indent',\n        '|',\n        'bulletedList',\n        'numberedList',\n        '|',\n        //'imageUpload',\n        'blockQuote',\n        //'insertTable',\n        'undo',\n        'redo'\n      ],\n\n      img_plugins = ['mUploadAdapter', 'ImageUpload', 'Image', 'ImageToolbar', 'ImageStyle', 'ImageUpload', 'ImageCaption'],\n      table_plugins = ['insertTable', 'Table', 'TableToolbar', 'TableProperties', 'TableCellProperties'],\n      headings_plugins = ['Heading'];\n\n    let script = document.createElement('script');\n    script.onload =  () => {\n\n      editor_list.forEach(function (item, idx) {\n\n        let options = {\n          uploaderUrl: cke_opts.upl_url,\n          uploadMaxSize : 4 * 1024 * 1024,\n          imgViewer: cke_opts.img_viewer,\n          toolbar: std_toolbar\n        };\n\n        // max size da attributo data\n        if(item.dataset.ckeUplMaxSize) { // in bytes\n          options.uploadMaxSize = item.dataset.ckeUplMaxSize;\n        }\n\n        // https://ckeditor.com/docs/ckeditor5/latest/builds/guides/integration/configuration.html#removing-features\n        if (item.classList.contains('editor-lite')) {\n          options = {\n            toolbar: lite_toolbar,\n            removePlugins: img_plugins,\n          };\n        } else if(item.classList.contains('editor-xlite')) {\n          options = {\n            toolbar: xlite_toolbar,\n            removePlugins: img_plugins.concat(table_plugins),\n          };\n        }\n\n        if(item.classList.contains('editor-no-headings')) {\n          options.toolbar = options.toolbar.filter(item => item !== 'heading');\n          options.removePlugins = options.removePlugins.concat(headings_plugins);\n        }\n\n        // rimozione eventuali separatori all'inizio e alla fine\n        if(options.toolbar[0] === '|') {\n          options.toolbar = options.toolbar.slice(1);\n        }\n        if(options.toolbar.slice(-1) === '|') {\n          options.toolbar = options.toolbar.slice(0, -1);\n        }\n\n        // console.log(options);\n\n        ClassicEditor.create(item, options)\n\n\n\n        // .then( editor => {\n        //   /* eslint-disable */\n        //   console.groupCollapsed();\n        //   console.log('textarea',  item );\n        //   console.log('editor',  editor );\n        //   console.log('toolbar elements',Array.from( editor.ui.componentFactory.names() ));\n        //   console.log('plugins', ClassicEditor.build.plugins.map( plugin => plugin.pluginName ));\n        //   console.groupEnd();\n        //   /* eslint-enable */\n        // })\n\n          .then( editor => {\n            if(item.disabled) {\n              editor.isReadOnly = true;\n            }\n            window.ckeditor_instances[item.id ? item.id : idx] = editor;\n\n            // abilita eventuali elementi disabilitati con attributo `data-enable=\"editor\"`\n            document.querySelectorAll('[data-enable=\"editor\"]:disabled').forEach( el => {\n              el.disabled = false;\n              el.closest('.form-group').classList.remove('disabled');\n            });\n          })\n          .catch( error => {\n            /* eslint-disable */\n            console.group('textarea ' + idx);\n            console.error(error);\n            console.log('textarea',  item );\n            console.groupEnd();\n            /* eslint-enable */\n          });\n\n      }); // end forEach\n\n    }; // end onload\n\n    script.src = cke_opts.cke_url;\n    script.type = 'text/javascript';\n    document.head.appendChild(script);\n\n  } // end if( editor_list.length\n\n}\n","import m_cke_loader from '../_m-ckeditor-loader';\nm_cke_loader();\n"]}